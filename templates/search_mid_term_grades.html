<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù†ØµÙÙŠØ©</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Arial, sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 40px; }
        .container { max-width: 600px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h1 { color: #1e3a8a; border-bottom: 3px solid #1e3a8a; padding-bottom: 10px; margin-bottom: 30px; text-align: center; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input[type="text"], select { 
            width: 100%; 
            padding: 10px; 
            margin-bottom: 20px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            box-sizing: border-box; 
        }
        button { 
            background-color: #0d6efd; 
            color: white; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 16px; 
            transition: background-color 0.3s;
            width: 100%;
        }
        button:hover { background-color: #0a58ca; }
        .back-link { margin-top: 20px; display: block; text-align: center; color: #333; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-search me-2"></i> Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù†ØµÙÙŠØ© Ù„Ù„Ø·Ø§Ù„Ø¨</h1>
        
        {# Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† action='{{ url_for('view_mid_term_grades') }}' #}
        <form method="GET" action="{{ url_for('view_mid_term_grades') }}" id="search_form"> 
            
            <div class="form-group">
                <label for="student_name_input">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</label>
                <input type="text" id="student_name_input" class="form-control" list="students_list" placeholder="Ø§Ø¨Ø¯Ø£ Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨..." required>
                
                <datalist id="students_list">
                    {# ğŸ›‘ Ø§Ù„ØªØµØ­ÙŠØ­: ÙŠØ¬Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ± 'students' ÙƒÙ…Ø§ ØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡ Ù…Ù† app.py ğŸ›‘ #}
                    {% for name, zk_user_id in students %}
                    <option data-zkid="{{ zk_user_id }}" value="{{ name }}">{{ name }} ({{ zk_user_id }})</option>
                    {% endfor %}
                </datalist>

                {# Ø­Ù‚Ù„ Ù…Ø®ÙÙŠ Ù„Ù€ zk_user_id #}
                <input type="hidden" id="zk_id" name="zk_id" required>
            </div>

            <div class="form-group">
                <label for="academic_year">Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ:</label>
                <select id="academic_year" name="year" class="form-control" required>
                    <option value="">Ø§Ø®ØªØ± Ø¹Ø§Ù…</option>
                    
                    {# ğŸ›‘ ÙŠØ¬Ø¨ ØªÙ…Ø±ÙŠØ± academic_years Ù…Ù† app.py Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ›‘ #}
                    {# Ø¨Ù…Ø§ Ø£Ù† app.py Ù„Ù… ÙŠÙ…Ø±Ø±Ù‡Ø§ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø±ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙ‚Ø· Ù…Ø¤Ù‚ØªØ§Ù‹ #}
                    <option value="{{ current_year }}" selected>{{ current_year }}</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">
                <i class="fas fa-search me-2"></i> Ø¨Ø­Ø« ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ù†ØµÙÙŠØ©
            </button>
        </form>

        <a class="back-link" href="{{ url_for('admin_reports') }}">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</a>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('student_name_input');
            const zkIdInput = document.getElementById('zk_id');
            const dataList = document.getElementById('students_list');
            const searchForm = document.getElementById('search_form');

            // Ø¯Ø§Ù„Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ù„ØªØ­Ù‚Ù‚ ÙˆØªØ¹ÙŠÙŠÙ† ZK ID
            function validateAndSetZkId() {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… .trim() Ù„Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ ÙØ±Ø§ØºØ§Øª ØºÙŠØ± Ù…Ø±Ø¦ÙŠØ© Ù‚Ø¯ ØªØ³Ø¨Ø¨ Ø§Ù„ÙØ´Ù„
                const selectedName = nameInput.value.trim(); 
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØªØ·Ø§Ø¨Ù‚ Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù…Ø¹ Ù‚ÙŠÙ…Ø© (value) Ø£ÙŠ Ø®ÙŠØ§Ø±
                const option = Array.from(dataList.options).find(opt => opt.value.trim() === selectedName);
                
                if (option) {
                    // Ø¥Ø°Ø§ ØªØ·Ø§Ø¨Ù‚ØªØŒ Ø¹ÙŠÙ‘Ù† Ù‚ÙŠÙ…Ø© ZK ID
                    zkIdInput.value = option.getAttribute('data-zkid');
                    zkIdInput.removeAttribute('required'); 
                } else {
                    // Ø¥Ø°Ø§ Ù„Ù… ØªØªØ·Ø§Ø¨Ù‚ØŒ Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø­Ù‚Ù„ ÙØ§Ø±ØºØ§Ù‹ ÙˆÙØ¹Ù‘Ù„ required Ù„Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                    zkIdInput.value = '';
                    zkIdInput.setAttribute('required', 'required');
                }
            }

            // Ø±Ø¨Ø· Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ø­Ø¯Ø«ÙŠ 'input' Ùˆ 'change' Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚ÙŠØ©
            nameInput.addEventListener('input', validateAndSetZkId);
            nameInput.addEventListener('change', validateAndSetZkId); 


            // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù€ ZK ID ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            searchForm.addEventListener('submit', function(e) {
                // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¯Ø§Ù„Ø© Ù…Ø±Ø© Ø£Ø®ÙŠØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                validateAndSetZkId(); 

                if (!zkIdInput.value) {
                    e.preventDefault();
                    alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³Ù… Ø·Ø§Ù„Ø¨ ØµØ­ÙŠØ­ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.');
                    nameInput.focus();
                }
            });
        });
    </script>
</body>
</html>